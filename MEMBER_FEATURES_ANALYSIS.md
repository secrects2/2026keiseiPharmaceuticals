# 會員功能分析報告

## 📊 現有資料表結構分析

根據您的資料庫，我發現了以下與會員相關的資料表：

### 會員核心資料
1. **users** - 用戶基本資料（email, role, community_id）
2. **member_profiles** - 會員詳細資料（生日、地址、LINE ID 等）
3. **member_consents** - 會員同意書記錄

### 會員活動與交易
4. **sport_coins** - 運動幣餘額
5. **coin_redemptions** - 運動幣兌換記錄
6. **member_activities** - 會員活動參與記錄
7. **member_purchases** - 會員購買記錄
8. **events** - 活動資訊

### 商品與訂單
9. **sports_products** - 運動商品
10. **purchase_orders** - 採購訂單
11. **purchase_order_items** - 訂單項目
12. **sports_sales** - 銷售記錄

## ❌ 目前的問題

**您目前只有管理後台（Admin），完全沒有會員前台！**

這意味著：
- ❌ 會員無法登入查看自己的資料
- ❌ 會員無法查看自己的運動幣餘額
- ❌ 會員無法查看活動報名記錄
- ❌ 會員無法兌換運動幣
- ❌ 會員無法購買商品
- ❌ 會員無法查看購買記錄

## ✅ 會員應該有的功能

根據您的資料表結構，我建議實現以下會員功能：

### 1. 會員儀表板 (/member/dashboard)

**核心資訊：**
- 👤 個人資料摘要（姓名、會員編號）
- 🪙 運動幣餘額（大字顯示）
- 📅 近期活動（即將參加的活動）
- 🎁 可兌換商品推薦

**統計卡片：**
- 總運動幣餘額
- 本月獲得運動幣
- 參與活動次數
- 已兌換商品數量

### 2. 個人資料管理 (/member/profile)

**可編輯資料：**
- 基本資料（姓名、生日、性別）
- 聯絡資訊（電話、地址）
- LINE Official ID
- 健康資訊（身高、體重、血型）
- 緊急聯絡人

**功能：**
- ✅ 編輯個人資料
- ✅ 上傳大頭照
- ✅ 修改密碼
- ✅ 查看會員等級

### 3. 運動幣管理 (/member/coins)

**功能：**
- 💰 查看運動幣餘額
- 📊 運動幣獲得/使用記錄（時間軸）
- 📈 運動幣統計圖表（每月獲得趨勢）
- 🎯 運動幣獲得方式說明

**記錄顯示：**
- 日期時間
- 交易類型（獲得/使用）
- 金額（+100 / -50）
- 來源/用途（參加活動 / 兌換商品）
- 餘額

### 4. 活動報名 (/member/events)

**功能：**
- 📅 瀏覽所有活動（即將到來 / 已結束）
- 🔍 搜尋活動（名稱、類型、日期）
- 📝 報名活動
- ✅ 查看已報名活動
- ❌ 取消報名（限期內）
- ⭐ 活動評價（參加後）

**活動資訊顯示：**
- 活動名稱、日期、時間
- 活動地點
- 活動描述
- 參與人數（已報名 / 上限）
- 獲得運動幣數量
- 報名狀態（可報名 / 已額滿 / 已報名）

### 5. 商品兌換 (/member/shop)

**功能：**
- 🛍️ 瀏覽可兌換商品
- 🔍 搜尋商品（名稱、分類）
- 🏷️ 分類篩選（營養補充品 / 運動器材 / 運動服飾）
- 🪙 運動幣兌換商品
- 📦 查看兌換記錄
- 🚚 查看配送狀態

**商品資訊顯示：**
- 商品圖片
- 商品名稱、品牌
- 兌換所需運動幣
- 庫存數量
- 商品描述
- 兌換按鈕（餘額足夠 / 餘額不足）

### 6. 兌換記錄 (/member/redemptions)

**功能：**
- 📜 查看所有兌換記錄
- 🔍 搜尋記錄（商品名稱、日期）
- 📊 兌換統計（總兌換次數、總花費運動幣）

**記錄顯示：**
- 兌換日期
- 商品名稱、圖片
- 兌換數量
- 花費運動幣
- 配送狀態（待處理 / 已發貨 / 已完成）
- 收貨地址

### 7. 購買記錄 (/member/purchases)

**功能：**
- 🛒 查看所有購買記錄
- 🔍 搜尋記錄（商品名稱、日期）
- 📊 購買統計（總購買次數、總金額）

**記錄顯示：**
- 購買日期
- 商品名稱、圖片
- 購買數量
- 購買金額
- 訂單狀態（待付款 / 已付款 / 已發貨 / 已完成）
- 收貨地址

### 8. 活動記錄 (/member/activities)

**功能：**
- 📋 查看所有參與活動記錄
- 🔍 搜尋記錄（活動名稱、日期）
- 📊 參與統計（總參與次數、總獲得運動幣）
- ⭐ 活動評價

**記錄顯示：**
- 活動日期
- 活動名稱、類型
- 參與狀態（已報名 / 已參加 / 已取消）
- 獲得運動幣
- 活動評價（星級）

### 9. 通知中心 (/member/notifications)

**功能：**
- 🔔 查看所有通知
- ✅ 標記為已讀
- 🗑️ 刪除通知

**通知類型：**
- 活動提醒（活動即將開始）
- 運動幣變動（獲得 / 使用）
- 兌換通知（商品已發貨）
- 系統通知（政策更新）

### 10. 設定 (/member/settings)

**功能：**
- 🔐 修改密碼
- 🔔 通知設定（Email / 推播）
- 🌐 語言設定
- 🎨 主題設定（深色 / 淺色）
- 📱 隱私設定
- 🚪 登出

## 🎨 會員前台設計建議

### 導航結構

**頂部導航：**
```
[Logo] 惠生醫藥集團 | 儀表板 | 活動 | 商品兌換 | 我的記錄 | [通知🔔] | [個人頭像▼]
```

**側邊欄導航：**
```
📊 儀表板
👤 個人資料
🪙 運動幣
📅 活動報名
🛍️ 商品兌換
📦 兌換記錄
🛒 購買記錄
📋 活動記錄
🔔 通知中心
⚙️ 設定
```

### 視覺風格

**色彩方案：**
- 主色：Indigo（與 Admin 一致）
- 輔色：Green（運動幣、正向操作）
- 警告色：Yellow（提醒）
- 錯誤色：Red（餘額不足）

**卡片設計：**
- 白色背景 + 灰色邊框
- 柔和陰影
- 圓角設計
- Hover 效果

**響應式設計：**
- 桌面：側邊欄 + 主內容區
- 平板：可收合側邊欄
- 手機：底部導航欄

## 🔐 權限控制

### 路由保護

**會員路由（/member/*）：**
- 需要登入
- 只有 role = 'user' 的用戶可以訪問
- Admin 用戶訪問時重導向到 /admin

**管理員路由（/admin/*）：**
- 需要登入
- 只有 role = 'admin' 的用戶可以訪問
- 一般會員訪問時重導向到 /member

### Middleware 更新

```typescript
// 會員路由保護
if (pathname.startsWith('/member') && user) {
  const { data: userData } = await supabase
    .from('users')
    .select('role')
    .eq('email', user.email)
    .single()

  if (userData?.role !== 'user') {
    return NextResponse.redirect(new URL('/admin', request.url))
  }
}

// 管理員路由保護
if (pathname.startsWith('/admin') && user) {
  const { data: userData } = await supabase
    .from('users')
    .select('role')
    .eq('email', user.email)
    .single()

  if (userData?.role !== 'admin') {
    return NextResponse.redirect(new URL('/member', request.url))
  }
}
```

## 📊 資料流程

### 會員登入流程

1. 用戶訪問 `/login`
2. 輸入 email 和密碼
3. Supabase 認證成功
4. 查詢 `users` 表取得 role
5. 根據 role 重導向：
   - `role = 'admin'` → `/admin`
   - `role = 'user'` → `/member`

### 運動幣兌換流程

1. 會員瀏覽商品列表
2. 點擊「兌換」按鈕
3. 檢查運動幣餘額是否足夠
4. 確認兌換
5. 扣除運動幣（更新 `sport_coins` 表）
6. 建立兌換記錄（插入 `coin_redemptions` 表）
7. 減少商品庫存（更新 `sports_inventory` 表）
8. 顯示兌換成功訊息

### 活動報名流程

1. 會員瀏覽活動列表
2. 點擊「報名」按鈕
3. 檢查活動是否已額滿
4. 確認報名
5. 建立活動記錄（插入 `member_activities` 表）
6. 增加活動參與人數（更新 `events` 表的 `current_participants`）
7. 顯示報名成功訊息

## 🎯 實現優先順序

### Phase 1：核心功能（必須實現）
1. ✅ 會員儀表板（概覽）
2. ✅ 個人資料管理
3. ✅ 運動幣查詢
4. ✅ 活動瀏覽和報名

### Phase 2：交易功能（重要）
5. ✅ 商品兌換
6. ✅ 兌換記錄
7. ✅ 活動記錄

### Phase 3：增強功能（建議）
8. ✅ 購買記錄
9. ✅ 通知中心
10. ✅ 設定頁面

## 📝 總結

**是的，您的會員絕對應該有屬於他們的功能！**

目前您的系統只有管理後台，會員完全無法使用。根據您的資料表結構，您已經有了完整的會員系統基礎（運動幣、活動、商品兌換等），但缺少會員前台介面。

建議立即實現：
1. **會員儀表板**：讓會員可以登入查看自己的資料
2. **運動幣管理**：讓會員可以查看和使用運動幣
3. **活動報名**：讓會員可以報名參加活動
4. **商品兌換**：讓會員可以用運動幣兌換商品

這些功能實現後，您的系統才是一個完整的「會員管理系統」，而不只是「管理員工具」。
